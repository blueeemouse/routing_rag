# routing_rag 项目开发进度

## 项目目标

构建一个可以支持检索方式routing的RAG系统，可以选择的是不用RAG/用naive RAG/用graphRAG。输入的query需要先进行分解，得到sub-query（当然，有可能遇到已经分解不了的情况）。各个sub-query会依次被routing到对应的检索方式中。目标是性能和成本的权衡。

## 架构设计

- **组件可替换性**: naive RAG、graphRAG、router、decomposer的实现都应该是可替换的
- **配置驱动**: 通过settings.yaml配置文件灵活切换不同实现
- **模块化**: 各组件遵循接口约定，便于开发和测试

## 当前进度

### 已完成任务

1. **基础架构搭建** - 完成

   - 查询分解器（Decomposer）接口定义和实现
   - 路由器（Router）接口定义和实现
   - RAG接口定义
   - 配置管理系统（settings.yaml, config.py）
   - Naive RAG基础实现
   - Graph RAG框架搭建
2. **测试验证** - 完成

   - Decomposer和Router的功能测试
   - Naive RAG与LlamaIndex集成测试
   - Graph RAG库导入验证测试
   - Graph RAG配置加载测试
3. **GraphRAG库集成** - 完成

   - 微软GraphRAG库导入和可用性检查
   - 配置参数从settings.yaml映射到GraphRAG
   - build_index方法实现（已修正参数命名）
   - 配置系统深入理解（root_dir参数、路径解析机制等）
4. **GraphRAG本地搜索功能完善** - 完成

   - 修复"sequence item 0: expected str instance, int found"错误
   - 实现了数据的正确类型转换（整数ID转字符串等）
   - 成功构建了GraphRAG搜索引擎
   - 成功执行查询并返回有用答案
   - 解决了DataFrame到GraphRAG实体类对象的转换问题
5. **GraphRAG execute方法集成** - 完成

   - execute方法成功集成_local_search功能
   - execute方法能够正确调用_local_search
   - 整个查询流程工作正常
   - 返回有意义的查询答案
6. **NaiveRAG索引构建解耦** - 完成（具体改进可以参考NaiveRAG索引构建改进计划.md）

   - 扩展RAGInterface接口，添加build_index方法
   - 实现NaiveRAG的build_index方法
   - 修改execute方法以使用预构建的索引
   - 保持向后兼容性
   - 验证重构后的功能

   改进后，NaiveRAG实现了索引构建与查询执行的解耦，提升性能和代码清晰度
7. **编排器(Orchestrator)实现** - **已完成**

   - 实现了orchestrator基础结构，定义了核心处理流程
   - 创建了mock组件用于验证架构（mocks/mock_components.py）
   - 集成了decomposer、router和RAG实现组件
   - 完成了使用模拟数据的端到端测试（tests/test_orchestrator_mock.py）
   - 验证了完整pipeline：查询 → 分解 → 路由 → 执行 → 合并结果

8. **NoRAG实现** - **已完成**

   - 创建了NoRAG实现，用于无检索增强的直接LLM响应
   - 实现了完整的RAGInterface接口
   - 存放于rag_implementations/no_rag目录下

9. **真实组件集成** - **已完成**

   - 成功集成decomposer、router和RAG实现的真实组件
   - 改进了orchestrator，支持传递context参数给RAG实现
   - 验证了NaiveRAG、GraphRAG和NoRAG的真实组件工作流程
   - 创建了测试脚本tests/test_orchestrator_real_components.py

### 正在进行的任务

- GraphRAG功能完善（实现其他搜索模式）

### 下一步计划

1. **GraphRAG功能完善**

   - 实现其他搜索模式（全局搜索、DRIFT搜索等）
   - 进一步优化查询功能
2. **配置驱动集成**

   - 通过settings.yaml配置文件灵活切换不同实现
   - 实现配置驱动的组件管理
3. **GraphRAG接口重构** - **已完成**

   - RAGInterface已重构，从单一的build_index方法改为两个专门的方法
     - build_index_from_data: 适用于内存数据驱动的RAG实现（如NaiveRAG）
     - build_index_from_path: 适用于文件系统驱动的RAG实现（如GraphRAG）
   - NaiveRAG已更新以实现build_index_from_data方法
   - GraphRAG已更新以实现build_index_from_path方法
   - 相关测试文件已更新（test_graphrag_build_index.py、test_api_calls.py）
   - 文档已更新以反映新的接口设计
4. **性能优化和扩展**

   - 优化各组件性能
   - 准备后续可能的组件替换实现

## 组件状态

- **Decomposer**: 基础LLM API调用版本已实现
- **Router**: 基础LLM API调用版本已实现
- **Naive RAG**: 基础LlamaIndex版本已实现
- **Graph RAG**: 完整实现，支持本地搜索模式
- **No RAG**: 直接LLM响应实现，已加入组件管理
- **Orchestrator**: 完整实现，支持context参数传递

## 配置管理

- 通过settings.yaml配置文件管理所有组件的参数
- 支持环境变量覆盖配置
- 配置热加载准备就绪
- 微软GraphRAG配置：理解了root_dir参数含义（项目根目录，相对路径的基准点）

## 当前版本日期

2025年12月10日
